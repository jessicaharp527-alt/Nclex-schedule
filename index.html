<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NCLEX Study Schedule</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f4f8; padding: 20px; }

  .header {
    background: linear-gradient(135deg, #1a4f7a, #2d7dd2);
    color: white; padding: 26px 28px; border-radius: 16px;
    margin-bottom: 22px; text-align: center;
  }
  .header h1 { font-size: 26px; font-weight: 700; margin-bottom: 5px; }
  .header p { font-size: 13px; opacity: 0.85; }
  .live-badge {
    display: inline-flex; align-items: center; gap: 6px;
    background: rgba(255,255,255,0.2); border-radius: 20px;
    padding: 4px 12px; font-size: 12px; margin-top: 8px;
  }
  .live-dot { width: 8px; height: 8px; border-radius: 50%; background: #48c774; animation: pulse 1.5s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }

  .stats-row { display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
  .stat-card {
    background: white; border-radius: 12px; padding: 14px 18px;
    flex: 1; min-width: 130px; text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.07);
  }
  .stat-card .num { font-size: 24px; font-weight: 700; color: #1a4f7a; }
  .stat-card .label { font-size: 11px; color: #666; margin-top: 3px; }
  .progress-bar-wrap { background: #e2e8f0; border-radius: 8px; height: 8px; margin-top: 8px; }
  .progress-bar { background: linear-gradient(90deg, #2d7dd2, #48c774); height: 8px; border-radius: 8px; width: 0%; transition: width 0.5s; }

  .legend {
    background: white; border-radius: 12px; padding: 12px 18px;
    margin-bottom: 18px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    display: flex; flex-wrap: wrap; gap: 12px; align-items: center;
  }
  .legend-title { font-size: 11px; font-weight: 700; color: #555; }
  .legend-item { display: flex; align-items: center; gap: 5px; font-size: 11px; color: #444; }
  .dot { width: 9px; height: 9px; border-radius: 50%; }
  .dot-archer { background: #2d7dd2; }
  .dot-video { background: #9b59b6; }
  .dot-pharm { background: #e67e22; }
  .dot-flash { background: #27ae60; }
  .dot-wrong { background: #e74c3c; }
  .dot-sa { background: #f39c12; }

  .week-label {
    font-size: 12px; font-weight: 700; color: #1a4f7a;
    text-transform: uppercase; letter-spacing: 1px;
    margin: 20px 0 8px; padding-left: 2px;
  }

  .day-card {
    background: white; border-radius: 12px; margin-bottom: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06); overflow: hidden;
    transition: opacity 0.3s;
  }
  .day-card.all-done { opacity: 0.5; }
  .day-card.today .day-header { background: #eaf3fc; }

  .day-header {
    display: flex; align-items: center; padding: 11px 15px;
    border-bottom: 1px solid #f0f4f8; gap: 8px; flex-wrap: wrap;
  }
  .day-name { font-weight: 700; color: #1a4f7a; font-size: 13px; min-width: 145px; }
  .badge {
    font-size: 10px; font-weight: 700; padding: 2px 8px;
    border-radius: 20px; white-space: nowrap;
  }
  .badge-today { background: #2d7dd2; color: white; }
  .badge-sa { background: #fff3cd; color: #b07a00; }
  .badge-review { background: #fdecea; color: #c0392b; }
  .q-range { font-size: 10px; color: #999; margin-left: auto; }

  .tasks { padding: 8px 15px 12px; }
  .section-title {
    font-size: 10px; font-weight: 700; text-transform: uppercase;
    letter-spacing: 0.8px; color: #bbb; margin: 9px 0 3px;
  }
  .section-title:first-child { margin-top: 2px; }

  .task {
    display: flex; align-items: flex-start; gap: 9px;
    padding: 6px 0; border-bottom: 1px solid #f7f9fb; cursor: pointer;
    user-select: none;
  }
  .task:last-child { border-bottom: none; }
  .task input[type="checkbox"] { width: 17px; height: 17px; margin-top: 1px; cursor: pointer; flex-shrink: 0; }
  .task input.archer { accent-color: #2d7dd2; }
  .task input.video { accent-color: #9b59b6; }
  .task input.pharm { accent-color: #e67e22; }
  .task input.flash { accent-color: #27ae60; }
  .task input.wrong { accent-color: #e74c3c; }
  .task input.sa { accent-color: #f39c12; }
  .task-text { font-size: 13px; color: #333; line-height: 1.4; }
  .task-text.done { text-decoration: line-through; color: #bbb; }
  .sa-task .task-text { font-weight: 600; color: #b07a00; }

  .loading {
    text-align: center; padding: 40px; color: #888; font-size: 14px;
  }
  .spinner {
    width: 32px; height: 32px; border: 3px solid #e2e8f0;
    border-top-color: #2d7dd2; border-radius: 50%;
    animation: spin 0.8s linear infinite; margin: 0 auto 12px;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  .sync-indicator {
    position: fixed; bottom: 16px; right: 16px;
    background: #27ae60; color: white; border-radius: 20px;
    padding: 6px 14px; font-size: 12px; font-weight: 600;
    opacity: 0; transition: opacity 0.3s; pointer-events: none;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }
  .sync-indicator.show { opacity: 1; }

  @media (max-width: 600px) {
    body { padding: 10px; }
    .day-name { min-width: 110px; font-size: 12px; }
  }
</style>
</head>
<body>

<div class="header">
  <h1>ðŸ“š NCLEX Study Schedule</h1>
  <p>Feb 19 â€“ March 17, 2026 &nbsp;|&nbsp; 27 Days to NCLEX</p>
  <div class="live-badge"><span class="live-dot"></span> Live &amp; Shared â€” Everyone sees your progress</div>
</div>

<div class="stats-row">
  <div class="stat-card">
    <div class="num">3,186</div>
    <div class="label">Archer Questions</div>
    <div class="progress-bar-wrap"><div class="progress-bar" id="archerBar"></div></div>
  </div>
  <div class="stat-card">
    <div class="num" id="saCount">0/6</div>
    <div class="label">UWorld Assessments Done</div>
    <div class="progress-bar-wrap"><div class="progress-bar" id="saBar"></div></div>
  </div>
  <div class="stat-card">
    <div class="num" id="pharmCount">0</div>
    <div class="label">Pharm Words Learned</div>
  </div>
  <div class="stat-card">
    <div class="num" id="pctDone">0%</div>
    <div class="label">Overall Progress</div>
  </div>
</div>

<div class="legend">
  <span class="legend-title">KEY:</span>
  <span class="legend-item"><span class="dot dot-archer"></span> Archer Qs</span>
  <span class="legend-item"><span class="dot dot-video"></span> Videos</span>
  <span class="legend-item"><span class="dot dot-pharm"></span> Pharmacology</span>
  <span class="legend-item"><span class="dot dot-flash"></span> Flashcards</span>
  <span class="legend-item"><span class="dot dot-wrong"></span> Wrong Q Review</span>
  <span class="legend-item"><span class="dot dot-sa"></span> UWorld SA</span>
</div>

<div id="schedule"><div class="loading"><div class="spinner"></div>Loading your schedule...</div></div>
<div class="sync-indicator" id="syncIndicator">âœ“ Saved &amp; Synced</div>

<script>
const STORAGE_KEY = 'nclex_schedule_progress_v2';

function buildSchedule() {
  const dates = [
    "Wed, Feb 19","Thu, Feb 20","Fri, Feb 21","Sat, Feb 22","Sun, Feb 23",
    "Mon, Feb 24","Tue, Feb 25","Wed, Feb 26","Thu, Feb 27","Fri, Feb 28",
    "Sat, Mar 1","Sun, Mar 2","Mon, Mar 3","Tue, Mar 4","Wed, Mar 5",
    "Thu, Mar 6","Fri, Mar 7","Sat, Mar 8","Sun, Mar 9","Mon, Mar 10",
    "Tue, Mar 11","Wed, Mar 12","Thu, Mar 13","Fri, Mar 14","Sat, Mar 15",
    "Sun, Mar 16","Mon, Mar 17"
  ];

  const saDays = {
    4: "UWorld Self Assessment #1",
    8: "UWorld Self Assessment #2",
    13: "UWorld Self Assessment #3",
    17: "UWorld Self Assessment #4",
    21: "UWorld Self Assessment #5",
    25: "UWorld Self Assessment #6",
  };

  const days = [];
  let qStart = 1;

  for (let i = 0; i < 27; i++) {
    const isReviewOnly = qStart > 3186;
    const hasSA = saDays[i] !== undefined;
    const tasks = [];
    let qRangeLabel = '';

    // Archer Questions
    if (!isReviewOnly) {
      let s1s = qStart, s1e = Math.min(qStart + 84, 3186);
      let s2s = null, s2e = null;
      if (s1e < 3186) {
        s2s = s1e + 1;
        s2e = Math.min(s2s + 84, 3186);
      }
      qRangeLabel = `Q${s1s}â€“${s2e || s1e}`;
      tasks.push({ section: "ðŸ”µ Archer Questions" });
      tasks.push({ text: `Set 1: Questions ${s1s}â€“${s1e} (${s1e - s1s + 1} Qs)`, type: "archer" });
      if (s2s) {
        tasks.push({ text: `Set 2: Questions ${s2s}â€“${s2e} (${s2e - s2s + 1} Qs)`, type: "archer" });
      }
      qStart = (s2e || s1e) + 1;
    } else {
      tasks.push({ section: "ðŸ”µ Archer Review" });
      tasks.push({ text: "Review your weakest Archer category today", type: "archer" });
    }

    tasks.push({ section: "ðŸŸ£ Archer Videos" });
    tasks.push({ text: "Watch Archer Video 1", type: "video" });
    tasks.push({ text: "Watch Archer Video 2", type: "video" });
    tasks.push({ text: "Watch Archer Video 3 (optional but encouraged)", type: "video" });

    tasks.push({ section: "ðŸ”´ Wrong Question Review" });
    tasks.push({ text: "Go over all wrong answers from today's sets â€” read every rationale", type: "wrong" });

    tasks.push({ section: "ðŸŸ¢ Flashcards" });
    tasks.push({ text: "Review flashcard deck (focus on weak areas first)", type: "flash" });

    tasks.push({ section: "ðŸŸ  Pharmacology" });
    tasks.push({ text: `Learn 5 new pharmacology words (Day ${i+1} â€” words ${i*5+1}â€“${i*5+5})`, type: "pharm" });
    tasks.push({ text: "Quick review of yesterday's 5 pharm words", type: "pharm" });

    if (hasSA) {
      tasks.push({ section: "ðŸŸ¡ UWorld Self Assessment" });
      tasks.push({ text: `${saDays[i]} â€” Complete the full exam`, type: "sa" });
      tasks.push({ text: "Record your score & identify your 3 weakest areas", type: "sa" });
      tasks.push({ text: "Study your weak areas from SA results", type: "sa" });
    }

    days.push({
      date: dates[i],
      today: i === 0,
      isReviewOnly,
      hasSA,
      qRangeLabel,
      tasks,
    });
  }
  return days;
}

const schedule = buildDays ? buildDays() : buildSchedule();

const weekLabels = {
  0: "ðŸ“… Week 1 â€” Feb 19â€“25",
  7: "ðŸ“… Week 2 â€” Feb 26 â€“ Mar 4",
  14: "ðŸ“… Week 3 â€” Mar 5â€“11",
  21: "ðŸ“… Week 4 â€” Mar 12â€“17 ðŸ",
};

let allChecked = {};
let syncTimer = null;

function countTasksInSchedule() {
  let total = 0, archerT = 0, saT = 0, pharmT = 0;
  schedule.forEach(day => {
    day.tasks.forEach(t => {
      if (t.section) return;
      total++;
      if (t.type === 'archer') archerT++;
      if (t.type === 'sa') saT++;
      if (t.type === 'pharm') pharmT++;
    });
  });
  return { total, archerT, saT, pharmT };
}

function updateStats() {
  const { total, archerT, saT, pharmT } = countTasksInSchedule();
  let checked = 0, archerC = 0, saC = 0, pharmC = 0;
  Object.keys(allChecked).forEach(k => {
    if (!allChecked[k]) return;
    checked++;
    const [di, ti] = k.split('_').map(Number);
    const day = schedule[di];
    let tIdx = 0;
    for (let t of day.tasks) {
      if (t.section) continue;
      if (tIdx === ti) {
        if (t.type === 'archer') archerC++;
        if (t.type === 'sa') saC++;
        if (t.type === 'pharm') pharmC++;
        break;
      }
      tIdx++;
    }
  });

  document.getElementById('archerBar').style.width = archerT ? Math.round(archerC/archerT*100)+'%' : '0%';
  document.getElementById('saBar').style.width = Math.round(saC/saT*100)+'%';
  document.getElementById('saCount').textContent = saC + '/6';
  document.getElementById('pharmCount').textContent = pharmC * 5;
  document.getElementById('pctDone').textContent = total ? Math.round(checked/total*100)+'%' : '0%';

  // Update card done states
  schedule.forEach((day, di) => {
    const card = document.querySelector(`[data-day="${di}"]`);
    if (!card) return;
    let tIdx = 0, total = 0, done = 0;
    day.tasks.forEach(t => {
      if (t.section) return;
      const key = `${di}_${tIdx}`;
      total++;
      if (allChecked[key]) done++;
      tIdx++;
    });
    card.classList.toggle('all-done', total > 0 && done === total);
  });
}

function renderSchedule() {
  const container = document.getElementById('schedule');
  container.innerHTML = '';

  schedule.forEach((day, di) => {
    if (weekLabels[di]) {
      const wl = document.createElement('div');
      wl.className = 'week-label';
      wl.textContent = weekLabels[di];
      container.appendChild(wl);
    }

    const card = document.createElement('div');
    card.className = 'day-card' + (day.today ? ' today' : '');
    card.dataset.day = di;

    const hdr = document.createElement('div');
    hdr.className = 'day-header';
    hdr.innerHTML = `
      <div class="day-name">${day.date}</div>
      ${day.today ? '<span class="badge badge-today">TODAY</span>' : ''}
      ${day.hasSA ? '<span class="badge badge-sa">ðŸ§ª SA Day</span>' : ''}
      ${day.isReviewOnly ? '<span class="badge badge-review">ðŸ“‹ Review Mode</span>' : ''}
      ${day.qRangeLabel ? `<span class="q-range">${day.qRangeLabel}</span>` : ''}
    `;
    card.appendChild(hdr);

    const tasksDiv = document.createElement('div');
    tasksDiv.className = 'tasks';
    let tIdx = 0;

    day.tasks.forEach(item => {
      if (item.section) {
        const sec = document.createElement('div');
        sec.className = 'section-title';
        sec.textContent = item.section;
        tasksDiv.appendChild(sec);
        return;
      }

      const key = `${di}_${tIdx}`;
      const checked = !!allChecked[key];
      const taskEl = document.createElement('div');
      taskEl.className = 'task' + (item.type === 'sa' ? ' sa-task' : '');

      taskEl.innerHTML = `
        <input type="checkbox" class="${item.type}" ${checked ? 'checked' : ''} data-key="${key}">
        <span class="task-text ${checked ? 'done' : ''}">${item.text}</span>
      `;
      taskEl.addEventListener('click', function(e) {
        const cb = this.querySelector('input');
        if (e.target !== cb) cb.checked = !cb.checked;
        const isChecked = cb.checked;
        const k = cb.dataset.key;
        allChecked[k] = isChecked;
        this.querySelector('.task-text').classList.toggle('done', isChecked);
        updateStats();
        saveProgress();
      });

      tasksDiv.appendChild(taskEl);
      tIdx++;
    });

    card.appendChild(tasksDiv);
    container.appendChild(card);
  });

  updateStats();
}

async function loadProgress() {
  try {
    const result = await window.storage.get(STORAGE_KEY, true);
    if (result && result.value) {
      allChecked = JSON.parse(result.value);
    }
  } catch(e) {
    allChecked = {};
  }
  renderSchedule();
}

let saveTimeout = null;
function saveProgress() {
  clearTimeout(saveTimeout);
  saveTimeout = setTimeout(async () => {
    try {
      await window.storage.set(STORAGE_KEY, JSON.stringify(allChecked), true);
      showSync();
    } catch(e) {}
  }, 400);
}

function showSync() {
  const el = document.getElementById('syncIndicator');
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 2000);
}

// Poll for updates every 15 seconds so viewers see live changes
setInterval(async () => {
  try {
    const result = await window.storage.get(STORAGE_KEY, true);
    if (result && result.value) {
      const fresh = JSON.parse(result.value);
      // Only re-render if something changed
      if (JSON.stringify(fresh) !== JSON.stringify(allChecked)) {
        allChecked = fresh;
        renderSchedule();
      }
    }
  } catch(e) {}
}, 15000);

loadProgress();
</script>
</body>
</html>
